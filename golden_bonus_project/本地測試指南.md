# 🧪 本地測試指南

## 📋 前置準備

### 1. 確認 Python 環境

```bash
# 確認 Python 版本（需要 Python 3.8+）
python3 --version

# 確認已安裝 pip
pip3 --version
```

### 2. 檢查項目結構

確認以下檔案存在：
- ✅ `main.py` - 主程式
- ✅ `requirements.txt` - 依賴套件清單
- ✅ `config/settings.py` - 配置文件
- ✅ `utils/gemini_client.py` - API 客戶端

## 🔑 設定 API Key

### 步驟 1：建立 .env 檔案

在 `golden_bonus_project` 目錄下建立 `.env` 檔案：

```bash
cd /Users/jackm4/Documents/GitHub/AI-Year-End-Bonus-Consultant/golden_bonus_project
touch .env
```

### 步驟 2：填入 API Key

編輯 `.env` 檔案，加入以下內容：

```env
GEMINI_API_KEY=你的_GEMINI_API_KEY_在這裡
```

**取得 API Key 的方式：**
1. 前往 [Google AI Studio](https://makersuite.google.com/app/apikey)
2. 登入 Google 帳號
3. 點擊「Create API Key」
4. 複製 API Key 到 `.env` 檔案

### 步驟 3：確認 .env 不會被上傳（安全性）

檢查 `.gitignore` 是否包含 `.env`：

```bash
grep -q "^\.env$" .gitignore && echo "✅ .env 已在 .gitignore" || echo "⚠️ 需要將 .env 加入 .gitignore"
```

如果沒有，請在 `.gitignore` 中加入：
```
.env
venv/
__pycache__/
*.pyc
```

## 🚀 啟動應用程式

### 方法一：使用啟動腳本（推薦）

```bash
cd /Users/jackm4/Documents/GitHub/AI-Year-End-Bonus-Consultant/golden_bonus_project
chmod +x 啟動.sh
./啟動.sh
```

這個腳本會：
- ✅ 自動檢查並建立虛擬環境（如果不存在）
- ✅ 自動安裝依賴套件
- ✅ 啟動 Streamlit 應用

### 方法二：手動啟動

#### 步驟 1：啟用虛擬環境

```bash
cd /Users/jackm4/Documents/GitHub/AI-Year-End-Bonus-Consultant/golden_bonus_project

# 如果虛擬環境不存在，先建立
if [ ! -d "venv" ]; then
    python3 -m venv venv
fi

# 啟用虛擬環境
source venv/bin/activate  # macOS/Linux
# 或
venv\Scripts\activate     # Windows
```

#### 步驟 2：安裝依賴

```bash
pip install -r requirements.txt
```

#### 步驟 3：啟動 Streamlit

```bash
streamlit run main.py
```

應用程式會在瀏覽器中自動打開，通常是：
- 🌐 http://localhost:8501

## 🧪 測試新功能（配置區）

### 測試重點：手機版配置區

1. **桌面瀏覽器測試**
   - 打開瀏覽器開發者工具（F12）
   - 切換到「響應式設計模式」（Ctrl+Shift+M / Cmd+Shift+M）
   - 選擇手機尺寸（如 iPhone 12 Pro）
   - 確認：
     - ✅ 主內容區頂部有「⚙️ CEO 決策槓桿配置」標題
     - ✅ 「🎯 展開配置面板」預設展開（不需要點擊）
     - ✅ 可以看到所有配置選項（快速预设、生存槓桿、激勵槓桿、現實槓桿）
     - ✅ 有清楚的使用提示文字

2. **手機實際測試**
   - 在同一網絡下，用手機訪問 `http://你的電腦IP:8501`
   - 例如：`http://192.168.1.100:8501`
   - 確認配置區可見且可用

3. **功能測試流程**

   **測試 1：配置同步**
   - 在主內容區調整「保留比例」滑桿
   - 檢查側邊欄的滑桿是否同步更新
   - 或反之，從側邊欄調整，檢查主內容區是否同步

   **測試 2：生成報告**
   - 使用主內容區的配置填入測試數據：
     - 稅前淨利：100 萬元
     - 符合發放資格人數：5 人
     - 平均月薪：40000 元
     - 保留比例：70%
   - 點擊主內容區的「生成分配草案」按鈕
   - 確認可以正常生成報告

   **測試 3：側邊欄按鈕**
   - 使用側邊欄的「生成分配草案」按鈕
   - 確認功能正常

## 📊 測試數據建議

第一次測試可以使用以下數據：

| 項目 | 數值 |
|------|------|
| 稅前淨利 | 100 萬元 |
| 符合發放資格人數 | 5 人 |
| 平均月薪 | 40000 元 |
| 保留比例 | 70% |
| 激勵策略 | 留才優先 |

預期結果：
- 總獎金池：約 30 萬元
- 人均金額：約 6 萬元
- 平均月數：約 3 個月

## ⚠️ 常見問題排除

### 問題 1：`ModuleNotFoundError: No module named 'streamlit'`

**解決方案：**
```bash
# 確認虛擬環境已啟用
source venv/bin/activate

# 重新安裝依賴
pip install -r requirements.txt
```

### 問題 2：`未找到 GEMINI_API_KEY`

**解決方案：**
1. 確認 `.env` 檔案存在於 `golden_bonus_project` 目錄
2. 確認 `.env` 檔案內容格式正確：
   ```env
   GEMINI_API_KEY=AIzaSyD8YF-WMvUdDJOIJ8p7Eh9B06-I_ZfPJVs
   ```
   （注意：等號兩邊不要有空格）
3. 確認 API Key 有效（可在 Google AI Studio 測試）

### 問題 3：`Address already in use` 或端口被佔用

**解決方案：**
```bash
# 使用其他端口啟動
streamlit run main.py --server.port 8502

# 或停止佔用 8501 端口的程式
lsof -ti:8501 | xargs kill -9  # macOS/Linux
```

### 問題 4：配置區在主內容區看不到

**解決方案：**
- 確認已使用最新版本的 `main.py`
- 清除瀏覽器緩存並重新整理（Ctrl+F5 / Cmd+Shift+R）
- 檢查瀏覽器控制台是否有 JavaScript 錯誤

### 問題 5：配置值不同步

**解決方案：**
- 確認兩個配置區都使用 `st.session_state.config_*` 變數
- 檢查是否有 JavaScript 錯誤
- 嘗試重新整理頁面

## 🎯 快速測試命令

```bash
# 一鍵啟動（如果已有虛擬環境和 .env）
cd /Users/jackm4/Documents/GitHub/AI-Year-End-Bonus-Consultant/golden_bonus_project
source venv/bin/activate
streamlit run main.py

# 檢查環境是否正確
python3 -c "import streamlit; import google.generativeai; import dotenv; print('✅ 所有依賴已安裝')"
```

## 📱 測試檢查清單

完成測試後，確認以下項目：

- [ ] 應用程式可以正常啟動
- [ ] `.env` 檔案已正確設定
- [ ] 主內容區配置區預設展開且可見
- [ ] 手機版（響應式模式）可以看到配置區
- [ ] 配置值在主內容區和側邊欄之間可以同步
- [ ] 可以正常生成報告
- [ ] 使用提示文字清楚可見
- [ ] 所有按鈕功能正常

## 🎉 完成！

如果以上測試都通過，恭喜！你的本地環境已經設定完成，可以開始使用 AI 年終獎金顧問系統了。

