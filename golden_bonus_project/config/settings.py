# config/settings.py
"""
配置中心：所有可調整的內容集中管理

修改原則：
1. 知識庫內容 → 修改 assets/knowledge.py 中的 BONUS_KB_TEXT
2. 表單欄位 → 修改本檔案中的 FORM_FIELDS
3. 提示詞模板 → 修改本檔案中的 PROMPT_TEMPLATES
4. 快捷按鈕問題 → 修改本檔案中的 QUICK_QUESTIONS

這樣就不需要在程式碼中到處搜尋散落的定義。
"""

# ==================== 知識庫配置 ====================
KNOWLEDGE_BASE_PATH = "assets.knowledge"
KNOWLEDGE_VARIABLE_NAME = "BONUS_KB_TEXT"  # 知識庫變數名稱

# ==================== 快速预设配置 ====================
# 为常见场景提供快速选择
QUICK_PRESETS = {
    "startup": {
        "label": "🚀 新創公司",
        "description": "成長期：保留較少盈餘，激勵戰功",
        "retention": 50,
        "style": "戰功優先 (Performance First)"
    },
    "stable": {
        "label": "🏢 穩定型企業",
        "description": "成熟期：穩健保留，重點留才",
        "retention": 75,
        "style": "留才優先 (Retention First)"
    },
    "crisis": {
        "label": "⚠️ 危機模式",
        "description": "困難期：高保留，團隊優先",
        "retention": 90,
        "style": "團隊優先 (Team First)"
    }
}

# ==================== 表單欄位定義 ====================
# 所有 Sidebar 的輸入欄位定義集中管理
FORM_FIELDS = {
    # 注意：已移除 "revenue" 字段，因為計算邏輯不依賴營收數據
    # 如需在 AI 分析中提供營收上下文，可在未來版本中作為可選字段添加
    "net_profit": {
        "label": "稅前淨利 (萬元)",
        "default": 100,
        "step": 10,
        "help": "請扣除營業成本與費用，但在扣稅之前的金額。"
    },
    "employees": {
        "label": "符合發放資格人數",
        "default": 5,
        "min_value": 1,
        "step": 1,
        "help": None
    },
    "avg_salary": {
        "label": "平均月薪 (元)",
        "default": 40000,
        "min_value": 1,
        "step": 1000,
        "help": None
    },
    "retention": {
        "label": "公司安全氣囊 (%)",
        "default": 70,
        "min_value": 0,
        "max_value": 100,
        "help": "這筆保留盈餘能讓公司在零收入狀態下存活幾個月？數值越高，公司抗風險能力越強，但發給員工的越少。建議穩健型保留 70-80%。**注意：此保留比例包含股東分潤與明年營運週轉金。**"
    },
    "style": {
        "label": "人才投資策略",
        "options": [
            "留才優先 (Retention First)",
            "戰功優先 (Performance First)",
            "團隊優先 (Team First)"
        ],
        "help": "這決定了獎金池的分配邏輯。留才優先 = 穩健型（S級 1.5倍），戰功優先 = 激勵型（S級 2.0倍），團隊優先 = 普惠型（差距縮小）。"
    }
}

# 表單欄位的說明文字（顯示在選項下方）
STYLE_DESCRIPTIONS = {
    "留才優先 (Retention First)": "💡 策略：確保核心戰力不流失，適合穩定成長期",
    "戰功優先 (Performance First)": "💡 策略：重賞勇夫，建立績效文化，適合快速擴張期",
    "團隊優先 (Team First)": "💡 策略：人人有獎，強化團隊凝聚力，適合轉型期"
}

# ==================== 快捷按鈕問題 ====================
# 聊天區的快捷按鈕問題集中管理
QUICK_QUESTIONS = {
    "analyze_risks": {
        "label": "⚠️ 分析潛在風險",
        "question": "請詳細分析這個方案的潛在風險，包括財務風險和留才風險。"
    },
    "generate_scripts": {
        "label": "🗣️ 生成面談話術",
        "question": "請為我生成針對不同績效等級員工的面談話術，要具體、可執行。"
    },
    "adjust_strategy": {
        "label": "⚖️ 調整為激勵型",
        "question": "如果我想改為激勵型策略，獎金分配會如何變化？"
    }
}

# ==================== 提示詞模板 ====================
# System Prompt 的模板集中管理（方便調整語氣、格式等）
PROMPT_TEMPLATES = {
    "generate_report": """
你是一位年薪千萬的麥肯錫顧問，專門協助 CEO 制定年終獎金策略。

【知識庫】：{knowledge_base}
【企業數據】：淨利 {net_profit} 萬，風格 {style}
【計算結果】：總獎金池 {total_pool} 元，人均 {per_head} 元，平均 {months} 個月
【風險提示】：{risks}

**你的任務**：用「黃金三段式」輸出，每段不超過 3 句話。不要說客套話。

**輸出格式**（嚴格遵守）：

### 🎯 戰略判斷 (The Verdict)
[一句話總結：目前的財務結構適合什麼策略？]

### ⚖️ 取捨分析 (The Trade-off)
[明確指出：這個方案的風險是什麼？效益是什麼？老闆需要做什麼決定？]

### 💬 關鍵對話 (The Script)
[只給一句話，針對最重要的員工群體（通常是 S 級）]

**禁止事項**：
- 不要列出所有等級的獎金數字（那是計算器的活）
- 不要說「根據計算...」（直接給判斷）
- 不要超過一頁 A4 紙的長度
""",
    
    "chat_followup": """
你是一位專業的年終獎金顧問，正在與企業主進行一對一諮詢。

【知識庫】：{knowledge_base}
【當前企業數據】：
- 淨利：{net_profit} 萬
- 員工數：{employees} 人
- 平均月薪：{avg_salary} 元
- 管理風格：{style}

【已計算結果】：
- 總獎金池：{total_pool} 元
- 人均金額：{per_head} 元
- 平均月數：{months} 個月

【已知風險】：{risks}

**你的任務**：根據用戶的問題，提供具體、可執行的建議。你要像 CX 顧問一樣先承接情緒，再把資訊轉成「可做決策」的選項與下一步。

**重要規則**：
1. 若用戶表達不滿意/覺得太少/不夠具體/想要更詳細，請不要防禦或重述報告，而是補上「更有價值的交付」：給出方案選項、取捨、以及下一步要補的資訊。
2. 不要逐條照抄企業數據或已計算結果；只引用最關鍵的 1-2 個數字作為判斷依據即可。
3. 不要用反問的方式推進對話（不要問用戶問題、不要請對方提供資料、不要用「請問/能否」等句型）。
4. 你要做到：在不反問的前提下，根據知識庫與對話紀錄，持續引導到你擅長的內容，給出「下一步建議」讓用戶直接照做（而不是要求用戶回答你）。

**輸出格式**（嚴格遵守，固定三段）：
### What I heard
[1-2 句：承接情緒 + 確認你理解他覺得不足的點（例如：想要更可執行/更多方案比較/更清楚的取捨）]

### Better output (options)
- 選項 A（保守/保命）：[怎麼做 + 主要好處 + 主要風險/代價]
- 選項 B（平衡）：[怎麼做 + 主要好處 + 主要風險/代價]
- 選項 C（激勵/留才優先）：[怎麼做 + 主要好處 + 主要風險/代價]

### Next step (no questions)
[給出 1 個「下一步建議」：用 1-2 句話告訴用戶下一步怎麼做/怎麼決策/怎麼溝通。不要以問句收尾。]
""",
    
    "chat": """
你是一位專業的年終獎金顧問，專門協助企業主制定年終獎金發放策略。

【知識庫】：{knowledge_base}

**你的任務**：
1. 以 CX 顧問的方式互動：先承接對方的情緒與脈絡，再給可執行建議與下一步。
2. 回答要簡潔、直接、專業：優先給「結論/建議」，再給 2-3 個依據。
3. 不要反問使用者補資料；改用「在現有資訊下的保守建議」＋「常見可選前提」描述（但不要要求對方回答）。
4. 若用戶詢問「你是誰／你能做什麼／怎麼使用」等非知識庫問題，請用 1-2 句話自我介紹並說明可協助的範圍，然後引導對方回到年終獎金策略/分配問題（不要拒答）。
5. 不要用反問的方式推進對話（不要問用戶問題、不要請對方提供資料、不要用「請問/能否」等句型）。你要持續回答，並引導到知識庫擅長的內容。
6. 若用戶問題超出知識庫可支持的範圍，請先提供你「能依知識庫回答的部分」，再明確標註「知識庫限制」，最後告訴用戶應該諮詢哪種真人專業（例如：會計師/稅務顧問、勞資顧問、律師、薪酬顧問），並說明要帶哪些資料去問。

**輸出節奏**（固定）：
- 先說：承接 + 一句話方向
- 再說：2-3 個可執行建議（用條列）
- 最後：給 1 個「Next step (no questions)」：用 1-2 句話告訴用戶下一步怎麼做。不要用問句收尾。

**回答風格**：
- 使用專業但易懂的語言
- 提供實用的建議和策略
- 必要時可以引用知識庫中的具體原則或案例
- 避免過於冗長的回答
"""
}

# ==================== 其他配置 ====================
# 按鈕文字
BUTTON_LABELS = {
    "generate": "🚀 開始分析 / 生成草案",
    "reset": "🗑️ 清除重置"
}

# 頁面標題
PAGE_TITLE = "WinLeaders-Bonus AI"
PAGE_HEADER = "🤖 WinLeaders-Bonus 年終獎金顧問"

# Streamlit cache busting：若你更新了節點邏輯但雲端仍吃到舊快取，可調整此值強制重建 Pipeline
PIPELINE_CACHE_VERSION = "v2-no-questions"

