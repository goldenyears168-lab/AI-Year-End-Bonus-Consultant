# ğŸš€ GoldenBonus AI é–‹ç™¼æ­¥é©ŸæŒ‡å—

**ç‰ˆæœ¬**ï¼šv1.0  
**ç›®æ¨™**ï¼šå¾é›¶é–‹å§‹å»ºç«‹åˆ°éƒ¨ç½²å®Œæˆçš„å®Œæ•´æµç¨‹  
**é©ç”¨å°è±¡**ï¼šç³»çµ±å·¥ç¨‹å¸« Jack

---

## ğŸ“‹ é–‹ç™¼å‰æº–å‚™æ¸…å–®

åœ¨é–‹å§‹å¯«ç¨‹å¼ç¢¼ä¹‹å‰ï¼Œè«‹ç¢ºèªä»¥ä¸‹äº‹é …ï¼š

- [ ] Python 3.9+ å·²å®‰è£
- [ ] VS Code æˆ–ä½ ç¿’æ…£çš„ IDE å·²æº–å‚™å¥½
- [ ] Git å·²åˆå§‹åŒ–ï¼ˆå¦‚æœè¦ç”¨ç‰ˆæœ¬æ§åˆ¶ï¼‰
- [ ] å·²å–å¾— Gemini API Keyï¼ˆå¾ Google AI Studioï¼‰
- [ ] å·²é–±è®€ PDR.mdã€KB.mdã€streamlitä»‹é¢.md ä¸‰ä»½æ–‡ä»¶

---

## éšæ®µä¸€ï¼šç’°å¢ƒè¨­ç½®èˆ‡å°ˆæ¡ˆçµæ§‹ (Environment Setup)

### æ­¥é©Ÿ 1.1ï¼šå»ºç«‹å°ˆæ¡ˆç›®éŒ„çµæ§‹

**åŸ·è¡Œå‹•ä½œ**ï¼š

```bash
# åœ¨çµ‚ç«¯æ©ŸåŸ·è¡Œ
mkdir golden_bonus_project
cd golden_bonus_project

# å»ºç«‹ç›®éŒ„çµæ§‹
mkdir -p core nodes assets config utils
touch core/__init__.py
touch nodes/__init__.py
touch config/__init__.py
touch utils/__init__.py
```

**é æœŸçµæœ**ï¼š

```
golden_bonus_project/
â”œâ”€â”€ core/
â”‚   â””â”€â”€ __init__.py
â”œâ”€â”€ nodes/
â”‚   â””â”€â”€ __init__.py
â”œâ”€â”€ assets/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ __init__.py
â””â”€â”€ utils/
    â””â”€â”€ __init__.py
```

**âœ… é©—æ”¶æ¨™æº–**ï¼š
- [ ] æ‰€æœ‰ç›®éŒ„éƒ½å·²å»ºç«‹
- [ ] æ‰€æœ‰ `__init__.py` æª”æ¡ˆéƒ½å­˜åœ¨ï¼ˆè®“ Python è­˜åˆ¥ç‚ºå¥—ä»¶ï¼‰

**âš ï¸ æ³¨æ„äº‹é …**ï¼š
- ç¢ºä¿ç›®éŒ„åç¨±èˆ‡ PDR.md ä¸­çš„çµæ§‹ä¸€è‡´
- `__init__.py` å¯ä»¥æ˜¯ç©ºæª”æ¡ˆï¼Œä½†å¿…é ˆå­˜åœ¨

---

### æ­¥é©Ÿ 1.2ï¼šå»ºç«‹ requirements.txt

**åŸ·è¡Œå‹•ä½œ**ï¼š

åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„å»ºç«‹ `requirements.txt`ï¼š

```txt
streamlit>=1.30.0
google-generativeai>=0.3.0
python-dotenv>=1.0.0
```

**åŸ·è¡Œå®‰è£**ï¼š

```bash
pip install -r requirements.txt
```

**âœ… é©—æ”¶æ¨™æº–**ï¼š
- [ ] `requirements.txt` æª”æ¡ˆå·²å»ºç«‹
- [ ] åŸ·è¡Œ `pip list | grep streamlit` ç¢ºèª streamlit å·²å®‰è£
- [ ] åŸ·è¡Œ `pip list | grep google-generativeai` ç¢ºèªå¥—ä»¶å·²å®‰è£
- [ ] åŸ·è¡Œ `pip list | grep python-dotenv` ç¢ºèªå¥—ä»¶å·²å®‰è£

**âš ï¸ æ³¨æ„äº‹é …**ï¼š
- å»ºè­°ä½¿ç”¨è™›æ“¬ç’°å¢ƒï¼ˆ`python -m venv venv`ï¼‰
- å¦‚æœä½¿ç”¨è™›æ“¬ç’°å¢ƒï¼Œè¨˜å¾—å…ˆå•Ÿå‹•ï¼ˆ`source venv/bin/activate` æˆ– `venv\Scripts\activate`ï¼‰

---

### æ­¥é©Ÿ 1.3ï¼šå»ºç«‹ .env æª”æ¡ˆ

**åŸ·è¡Œå‹•ä½œ**ï¼š

åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„å»ºç«‹ `.env` æª”æ¡ˆï¼š

```plaintext
GEMINI_API_KEY=your-gemini-api-key-here
```

**âœ… é©—æ”¶æ¨™æº–**ï¼š
- [ ] `.env` æª”æ¡ˆå·²å»ºç«‹
- [ ] æª”æ¡ˆä¸­åŒ…å« `GEMINI_API_KEY=...`ï¼ˆè«‹å¡«å…¥çœŸå¯¦çš„ API Keyï¼‰
- [ ] `.gitignore` æª”æ¡ˆä¸­åŒ…å« `.env`ï¼ˆé¿å…ä¸Šå‚³åˆ° GitHubï¼‰

**âš ï¸ æ³¨æ„äº‹é …**ï¼š
- **çµ•å°ä¸è¦**å°‡ `.env` ä¸Šå‚³åˆ° GitHub
- å¦‚æœä½¿ç”¨ Gitï¼Œç¢ºèª `.gitignore` åŒ…å«ï¼š
  ```
  .env
  __pycache__/
  *.pyc
  .streamlit/secrets.toml
  ```

**ğŸ” æ¸¬è©¦æª¢æŸ¥**ï¼š
- [ ] åŸ·è¡Œ `python -c "from dotenv import load_dotenv; import os; load_dotenv(); print('OK' if os.getenv('GEMINI_API_KEY') else 'FAIL')"` æ‡‰è©²é¡¯ç¤º OK

---

## éšæ®µäºŒï¼šæ ¸å¿ƒå¼•æ“å¯¦ä½œ (Core Engine)

### æ­¥é©Ÿ 2.1ï¼šå¯¦ä½œ BaseNode (core/base_node.py)

**åŸ·è¡Œå‹•ä½œ**ï¼š

å»ºç«‹ `core/base_node.py`ï¼š

```python
# core/base_node.py
from abc import ABC, abstractmethod
from typing import Dict, Any

class BaseNode(ABC):
    """
    é€™æ˜¯æ‰€æœ‰ç¯€é»çš„ã€Œçˆ¸çˆ¸ã€ï¼ˆçˆ¶é¡åˆ¥ï¼‰ã€‚
    å®ƒè¦å®šæ‰€æœ‰ç¹¼æ‰¿å®ƒçš„ã€Œå­©å­ã€éƒ½å¿…é ˆæœƒåš execute é€™ä»¶äº‹ã€‚
    """
    def __init__(self, name: str):
        self.name = name

    @abstractmethod
    def execute(self, context: Dict[str, Any]) -> Dict[str, Any]:
        """
        è¼¸å…¥ï¼šcontext (èˆŠçš„)
        è¼¸å‡ºï¼šcontext (æ–°çš„ï¼ŒåŠ ä¸Šé€™å€‹ç¯€é»è™•ç†å¾Œçš„çµæœ)
        """
        pass
```

**âœ… é©—æ”¶æ¨™æº–**ï¼š
- [ ] æª”æ¡ˆå·²å»ºç«‹ä¸”èªæ³•æ­£ç¢º
- [ ] å¯ä»¥æˆåŠŸ `from core.base_node import BaseNode`
- [ ] å˜—è©¦å»ºç«‹ä¸€å€‹ç¹¼æ‰¿ BaseNode çš„é¡åˆ¥ï¼Œä¸å¯¦ä½œ `execute` æœƒå ±éŒ¯ï¼ˆé©—è­‰ abstractmethod æœ‰æ•ˆï¼‰

**ğŸ” æ¸¬è©¦æª¢æŸ¥**ï¼š

å»ºç«‹æ¸¬è©¦æª”æ¡ˆ `test_base_node.py`ï¼š

```python
# test_base_node.py
from core.base_node import BaseNode
from typing import Dict, Any

# æ¸¬è©¦ 1ï¼šå˜—è©¦å»ºç«‹ä¸€å€‹ä¸å¯¦ä½œ execute çš„é¡åˆ¥ï¼ˆæ‡‰è©²å ±éŒ¯ï¼‰
try:
    class BadNode(BaseNode):
        pass
    
    node = BadNode("Test")
    print("âŒ æ¸¬è©¦å¤±æ•—ï¼šæ‡‰è©²è¦å ±éŒ¯")
except TypeError as e:
    print("âœ… æ¸¬è©¦é€šéï¼šabstractmethod æœ‰æ•ˆ")

# æ¸¬è©¦ 2ï¼šå»ºç«‹ä¸€å€‹æ­£ç¢ºçš„ç¯€é»
class GoodNode(BaseNode):
    def execute(self, context: Dict[str, Any]) -> Dict[str, Any]:
        context["test"] = "passed"
        return context

node = GoodNode("GoodNode")
result = node.execute({})
assert result["test"] == "passed"
print("âœ… æ¸¬è©¦é€šéï¼šç¯€é»å¯ä»¥æ­£å¸¸åŸ·è¡Œ")
```

åŸ·è¡Œæ¸¬è©¦ï¼š`python test_base_node.py`

**âš ï¸ æ³¨æ„äº‹é …**ï¼š
- ç¢ºä¿ `from abc import ABC, abstractmethod` æ­£ç¢ºå°å…¥
- `execute` æ–¹æ³•å¿…é ˆè¿”å› `Dict[str, Any]`

---

### æ­¥é©Ÿ 2.2ï¼šå¯¦ä½œ Pipeline (core/pipeline.py)

**åŸ·è¡Œå‹•ä½œ**ï¼š

å»ºç«‹ `core/pipeline.py`ï¼š

```python
# core/pipeline.py
from typing import List, Dict, Any
from core.base_node import BaseNode

class Pipeline:
    def __init__(self):
        self.nodes: List[BaseNode] = [] # æº–å‚™ä¸€å€‹ç©ºçš„æ¸…å–®ä¾†æ”¾ç¯€é»

    def add_node(self, node: BaseNode):
        self.nodes.append(node)
        return self # è®“æˆ‘å€‘å¯ä»¥å¯« .add().add() é€™ç¨®éŠå¼èªæ³•

    def run(self, context: Dict[str, Any]) -> Dict[str, Any]:
        print("ğŸš€ Pipeline é–‹å§‹é‹ä½œ...")
        
        # é€™æ˜¯æœ€é—œéµçš„è¿´åœˆï¼šåƒå¤§éšŠæ¥åŠ›ä¸€æ¨£å‚³é context
        for node in self.nodes:
            try:
                print(f"   Running node: {node.name}")
                context = node.execute(context) # æ¥æ£’ï¼
            except Exception as e:
                print(f"âŒ Error in {node.name}: {e}")
                context["error"] = str(e) # æŠŠéŒ¯èª¤è¨˜ä¸‹ä¾†ï¼Œä¸è¦è®“ç¨‹å¼å´©æ½°
                break # åœæ­¢ç”¢ç·š
        
        print("âœ… Pipeline å®Œæˆ")
        return context
```

**âœ… é©—æ”¶æ¨™æº–**ï¼š
- [ ] æª”æ¡ˆå·²å»ºç«‹ä¸”èªæ³•æ­£ç¢º
- [ ] å¯ä»¥æˆåŠŸ `from core.pipeline import Pipeline`
- [ ] å¯ä»¥å»ºç«‹ Pipeline å¯¦ä¾‹
- [ ] å¯ä»¥æˆåŠŸ `add_node()` å’Œ `run()`

**ğŸ” æ¸¬è©¦æª¢æŸ¥**ï¼š

å»ºç«‹æ¸¬è©¦æª”æ¡ˆ `test_pipeline.py`ï¼š

```python
# test_pipeline.py
from core.pipeline import Pipeline
from core.base_node import BaseNode
from typing import Dict, Any

class TestNode(BaseNode):
    def execute(self, context: Dict[str, Any]) -> Dict[str, Any]:
        context["test"] = context.get("test", 0) + 1
        return context

# æ¸¬è©¦ 1ï¼šå»ºç«‹ Pipeline ä¸¦åŠ å…¥ç¯€é»
pipeline = Pipeline()
pipeline.add_node(TestNode("Node1"))
pipeline.add_node(TestNode("Node2"))

# æ¸¬è©¦ 2ï¼šåŸ·è¡Œ Pipeline
result = pipeline.run({})
assert result["test"] == 2, f"Expected 2, got {result['test']}"
print("âœ… æ¸¬è©¦é€šéï¼šPipeline å¯ä»¥æ­£å¸¸åŸ·è¡Œå¤šå€‹ç¯€é»")

# æ¸¬è©¦ 3ï¼šæ¸¬è©¦éŒ¯èª¤è™•ç†
class ErrorNode(BaseNode):
    def execute(self, context: Dict[str, Any]) -> Dict[str, Any]:
        raise ValueError("æ¸¬è©¦éŒ¯èª¤")

pipeline2 = Pipeline()
pipeline2.add_node(TestNode("Node1"))
pipeline2.add_node(ErrorNode("ErrorNode"))
pipeline2.add_node(TestNode("Node3"))  # é€™ä¸æ‡‰è©²åŸ·è¡Œ

result2 = pipeline2.run({})
assert "error" in result2, "æ‡‰è©²è¦æœ‰éŒ¯èª¤è¨Šæ¯"
assert result2["test"] == 1, "éŒ¯èª¤å¾Œçš„ç¯€é»ä¸æ‡‰è©²åŸ·è¡Œ"
print("âœ… æ¸¬è©¦é€šéï¼šéŒ¯èª¤è™•ç†æ­£å¸¸")
```

åŸ·è¡Œæ¸¬è©¦ï¼š`python test_pipeline.py`

**âš ï¸ æ³¨æ„äº‹é …**ï¼š
- ç¢ºä¿éŒ¯èª¤è™•ç†é‚è¼¯æ­£ç¢ºï¼ˆéŒ¯èª¤æ™‚åœæ­¢ï¼Œä½†ä¸å´©æ½°ï¼‰
- ç¢ºèª `add_node` è¿”å› `self`ï¼Œæ”¯æ´éŠå¼èªæ³•

---

## éšæ®µä¸‰ï¼šæ¥­å‹™é‚è¼¯å¯¦ä½œ (Business Logic)

### æ­¥é©Ÿ 3.1ï¼šå»ºç«‹é…ç½®ä¸­å¿ƒ (config/settings.py)

**åŸ·è¡Œå‹•ä½œ**ï¼š

å»ºç«‹ `config/settings.py`ï¼Œå°‡ PDR.md ç¬¬ä¹ç« ä¸­çš„é…ç½®ä¸­å¿ƒå…§å®¹å®Œæ•´è¤‡è£½éå»ã€‚

**âœ… é©—æ”¶æ¨™æº–**ï¼š
- [ ] æª”æ¡ˆå·²å»ºç«‹
- [ ] å¯ä»¥æˆåŠŸ `from config.settings import FORM_FIELDS, QUICK_QUESTIONS`
- [ ] æ‰€æœ‰å­—å…¸çµæ§‹å®Œæ•´ï¼ˆFORM_FIELDSã€QUICK_QUESTIONSã€PROMPT_TEMPLATES ç­‰ï¼‰

**ğŸ” æ¸¬è©¦æª¢æŸ¥**ï¼š

```python
# test_config.py
from config.settings import (
    FORM_FIELDS, 
    QUICK_QUESTIONS, 
    PROMPT_TEMPLATES,
    BUTTON_LABELS
)

# æ¸¬è©¦ 1ï¼šç¢ºèªæ‰€æœ‰é…ç½®éƒ½å­˜åœ¨
assert "revenue" in FORM_FIELDS
assert "analyze_risks" in QUICK_QUESTIONS
assert "generate_report" in PROMPT_TEMPLATES
print("âœ… æ¸¬è©¦é€šéï¼šæ‰€æœ‰é…ç½®éƒ½å­˜åœ¨")

# æ¸¬è©¦ 2ï¼šç¢ºèªé…ç½®çµæ§‹æ­£ç¢º
assert "label" in FORM_FIELDS["revenue"]
assert "default" in FORM_FIELDS["revenue"]
print("âœ… æ¸¬è©¦é€šéï¼šé…ç½®çµæ§‹æ­£ç¢º")
```

**âš ï¸ æ³¨æ„äº‹é …**ï¼š
- é€™æ˜¯**é›†ä¸­ç·¨è¼¯å€**ï¼Œæœªä¾†æ‰€æœ‰è¡¨å–®æ¬„ä½ã€å¿«æ·å•é¡Œã€æç¤ºè©éƒ½åœ¨é€™è£¡ä¿®æ”¹
- ç¢ºä¿æ‰€æœ‰å­—ä¸²æ ¼å¼æ­£ç¢ºï¼ˆç‰¹åˆ¥æ˜¯ PROMPT_TEMPLATES ä¸­çš„å¤šè¡Œå­—ä¸²ï¼‰

---

### æ­¥é©Ÿ 3.2ï¼šå»ºç«‹çŸ¥è­˜åº« (assets/knowledge.py)

**åŸ·è¡Œå‹•ä½œ**ï¼š

å»ºç«‹ `assets/knowledge.py`ï¼Œå°‡ KB.md ä¸­çš„ `BONUS_KB_TEXT` å…§å®¹å®Œæ•´è¤‡è£½éå»ã€‚

**âœ… é©—æ”¶æ¨™æº–**ï¼š
- [ ] æª”æ¡ˆå·²å»ºç«‹
- [ ] å¯ä»¥æˆåŠŸ `from assets.knowledge import BONUS_KB_TEXT`
- [ ] `BONUS_KB_TEXT` æ˜¯å­—ä¸²é¡å‹ä¸”ä¸ç‚ºç©º

**ğŸ” æ¸¬è©¦æª¢æŸ¥**ï¼š

```python
# test_knowledge.py
from assets.knowledge import BONUS_KB_TEXT

# æ¸¬è©¦ 1ï¼šç¢ºèªçŸ¥è­˜åº«å­˜åœ¨ä¸”ä¸ç‚ºç©º
assert isinstance(BONUS_KB_TEXT, str)
assert len(BONUS_KB_TEXT) > 100, "çŸ¥è­˜åº«å…§å®¹å¤ªçŸ­"
print("âœ… æ¸¬è©¦é€šéï¼šçŸ¥è­˜åº«å­˜åœ¨ä¸”å…§å®¹å®Œæ•´")

# æ¸¬è©¦ 2ï¼šç¢ºèªåŒ…å«é—œéµç« ç¯€
assert "ç¬¬ä¸€ç« " in BONUS_KB_TEXT or "æ ¸å¿ƒå“²å­¸" in BONUS_KB_TEXT
assert "åç›´è¦ºæ´å¯Ÿ" in BONUS_KB_TEXT or "ç¬¬å…­ç« " in BONUS_KB_TEXT
print("âœ… æ¸¬è©¦é€šéï¼šçŸ¥è­˜åº«åŒ…å«å¿…è¦ç« ç¯€")
```

**âš ï¸ æ³¨æ„äº‹é …**ï¼š
- é€™æ˜¯**é›†ä¸­ç·¨è¼¯å€**ï¼Œæœªä¾†æ‰€æœ‰çŸ¥è­˜åº«å…§å®¹éƒ½åœ¨é€™è£¡ä¿®æ”¹
- ç¢ºä¿å­—ä¸²ä½¿ç”¨ä¸‰é‡å¼•è™Ÿ `"""` åŒ…åœï¼Œæ”¯æ´å¤šè¡Œ

---

### æ­¥é©Ÿ 3.3ï¼šå¯¦ä½œ CalculatorNode (nodes/calculator.py)

**åŸ·è¡Œå‹•ä½œ**ï¼š

å»ºç«‹ `nodes/calculator.py`ï¼Œåƒè€ƒ PDR.md 4.1 ç¯€çš„ç¨‹å¼ç¢¼ã€‚

**å®Œæ•´ç¨‹å¼ç¢¼**ï¼š

```python
# nodes/calculator.py
from core.base_node import BaseNode
from typing import Dict, Any

class CalculatorNode(BaseNode):
    def execute(self, context: Dict[str, Any]) -> Dict[str, Any]:
        data = context["user_input"]
        
        # 1. å®‰å…¨æª¢æŸ¥ï¼šé¿å…é™¤ä»¥é›¶çš„éŒ¯èª¤
        if data["employees"] <= 0:
            raise ValueError("å“¡å·¥äººæ•¸ä¸èƒ½ç‚º 0 æˆ–è² æ•¸")
        if data["avg_salary"] <= 0:
            raise ValueError("å¹³å‡æœˆè–ªä¸èƒ½ç‚º 0 æˆ–è² æ•¸")

        # 2. æ ¸å¿ƒå…¬å¼
        pool = data["net_profit"] * (1 - data["retention_rate"])
        per_head = pool / data["employees"]
        months = per_head / data["avg_salary"]

        # 3. å¯«å…¥ Metrics
        context["metrics"] = {
            "total_pool": int(pool),
            "per_head": int(per_head),
            "months": round(months, 2)
        }
        
        # 4. é¢¨éšªæª¢æŸ¥ï¼ˆç²¾å¯¦ï¼šç›´æ¥åœ¨é€™è£¡æª¢æŸ¥ï¼‰
        risks = []
        
        # è¦å‰‡ 1: ç™¼å¤ªå°‘ (ä½æ–¼ 0.5 å€‹æœˆ)
        if months < 0.5:
            risks.append("âš ï¸ **ç´…è‰²è­¦å ±**ï¼šå¹³å‡çé‡‘ä½æ–¼ 0.5 å€‹æœˆï¼Œæ ¹æ“šçµ±è¨ˆï¼Œé€™æœƒå°è‡´å¹´å¾Œé›¢è·ç‡ä¸Šå‡ 30%ã€‚")
        
        # è¦å‰‡ 2: ç™¼å¤ªå¤š (é€æ”¯ä¿ç•™ç›ˆé¤˜)
        if data["retention_rate"] < 0.1:
            risks.append("âš ï¸ **è²¡å‹™è­¦å‘Š**ï¼šæ‚¨çš„ä¿ç•™ç›ˆé¤˜éä½ï¼Œå…¬å¸ç¾é‡‘æµæŠ—é¢¨éšªèƒ½åŠ›å°‡æ¸›å¼±ã€‚")
        
        context["risks"] = risks
        
        return context
```

**âœ… é©—æ”¶æ¨™æº–**ï¼š
- [ ] æª”æ¡ˆå·²å»ºç«‹ä¸”èªæ³•æ­£ç¢º
- [ ] å¯ä»¥æˆåŠŸ `from nodes.calculator import CalculatorNode`
- [ ] å¯ä»¥å»ºç«‹ CalculatorNode å¯¦ä¾‹

**ğŸ” æ¸¬è©¦æª¢æŸ¥**ï¼š

å»ºç«‹æ¸¬è©¦æª”æ¡ˆ `test_calculator.py`ï¼š

```python
# test_calculator.py
from nodes.calculator import CalculatorNode

# æ¸¬è©¦ 1ï¼šæ­£å¸¸è¨ˆç®—
node = CalculatorNode("Calculator")
context = {
    "user_input": {
        "net_profit": 200,  # 200 è¬
        "retention_rate": 0.7,
        "employees": 5,
        "avg_salary": 40000
    }
}

result = node.execute(context)
assert "metrics" in result
assert result["metrics"]["total_pool"] == 60  # 200 * 0.3 = 60 è¬
assert result["metrics"]["per_head"] == 12  # 60 / 5 = 12 è¬
assert result["metrics"]["months"] == 3.0  # 12 è¬ / 4 è¬ = 3
print("âœ… æ¸¬è©¦é€šéï¼šæ­£å¸¸è¨ˆç®—æ­£ç¢º")

# æ¸¬è©¦ 2ï¼šé™¤ä»¥é›¶ä¿è­·
try:
    context_zero = {
        "user_input": {
            "net_profit": 200,
            "retention_rate": 0.7,
            "employees": 0,  # é™¤ä»¥é›¶
            "avg_salary": 40000
        }
    }
    node.execute(context_zero)
    print("âŒ æ¸¬è©¦å¤±æ•—ï¼šæ‡‰è©²è¦å ±éŒ¯")
except ValueError as e:
    assert "å“¡å·¥äººæ•¸" in str(e)
    print("âœ… æ¸¬è©¦é€šéï¼šé™¤ä»¥é›¶ä¿è­·æœ‰æ•ˆ")

# æ¸¬è©¦ 3ï¼šé¢¨éšªæª¢æŸ¥ï¼ˆä½æ–¼ 0.5 å€‹æœˆï¼‰
context_low = {
    "user_input": {
        "net_profit": 10,  # å¾ˆå°‘çš„æ·¨åˆ©
        "retention_rate": 0.7,
        "employees": 10,
        "avg_salary": 50000
    }
}
result_low = node.execute(context_low)
assert len(result_low["risks"]) > 0, "æ‡‰è©²è¦æœ‰é¢¨éšªè­¦å‘Š"
print("âœ… æ¸¬è©¦é€šéï¼šé¢¨éšªæª¢æŸ¥æœ‰æ•ˆ")
```

åŸ·è¡Œæ¸¬è©¦ï¼š`python test_calculator.py`

**âš ï¸ æ³¨æ„äº‹é …**ï¼š
- æ³¨æ„å–®ä½æ›ç®—ï¼ˆnet_profit æ˜¯è¬å…ƒï¼Œavg_salary æ˜¯å…ƒï¼‰
- ç¢ºä¿æ‰€æœ‰é‚Šç•Œæƒ…æ³éƒ½æœ‰è™•ç†ï¼ˆé™¤ä»¥é›¶ã€è² æ•¸ç­‰ï¼‰

---

### æ­¥é©Ÿ 3.4ï¼šå»ºç«‹ Gemini API Client (utils/gemini_client.py)

**åŸ·è¡Œå‹•ä½œ**ï¼š

å»ºç«‹ `utils/gemini_client.py`ï¼Œåƒè€ƒ PDR.md ç¬¬ä¸ƒç« çš„ç¨‹å¼ç¢¼ã€‚

**å®Œæ•´ç¨‹å¼ç¢¼**ï¼š

```python
# utils/gemini_client.py
import google.generativeai as genai
import os
from dotenv import load_dotenv
import streamlit as st

# è‡ªå‹•åˆ¤æ–·æ˜¯æœ¬åœ°é–‹ç™¼é‚„æ˜¯é›²ç«¯
load_dotenv()
api_key = os.getenv("GEMINI_API_KEY") or st.secrets.get("GEMINI_API_KEY", "")

if not api_key:
    raise ValueError("æœªæ‰¾åˆ° GEMINI_API_KEYï¼Œè«‹æª¢æŸ¥ .env æˆ– Streamlit Secrets")

genai.configure(api_key=api_key)

def call_gemini_logic(system_prompt, user_message, history=[], model="gemini-2.0-flash-exp", temperature=0.7, max_tokens=2000):
    """
    å‘¼å« Gemini API çš„çµ±ä¸€å…¥å£
    
    Args:
        system_prompt: ç³»çµ±æç¤ºè©
        user_message: ç”¨æˆ¶è¨Šæ¯
        history: List[Dict] æ ¼å¼çš„å°è©±æ­·å²ï¼Œæ ¼å¼ç‚º [{"role": "user/assistant", "content": "..."}]
        model: æ¨¡å‹åç¨±ï¼Œé è¨­ gemini-2.0-flash-exp
        temperature: å‰µé€ åŠ›åƒæ•¸ï¼Œ0.0-1.0
        max_tokens: æœ€å¤§è¼¸å‡ºé•·åº¦
    
    Returns:
        str: AI å›æ‡‰å…§å®¹ï¼Œæˆ–éŒ¯èª¤è¨Šæ¯
    """
    try:
        # ä½¿ç”¨ system_instruction åƒæ•¸è¨­å®šç³»çµ±æç¤ºè©
        model_instance = genai.GenerativeModel(
            model_name=model,
            system_instruction=system_prompt,
            generation_config=genai.types.GenerationConfig(
                temperature=temperature,
                max_output_tokens=max_tokens,
            )
        )
        
        # å»ºç«‹èŠå¤©æœƒè©±
        chat = model_instance.start_chat(history=[])
        
        # åŠ å…¥æ­·å²å°è©±ï¼ˆæŒ‰é †åºç™¼é€ç”¨æˆ¶è¨Šæ¯ï¼ŒGemini æœƒè‡ªå‹•ç®¡ç†å°è©±æ­·å²ï¼‰
        for msg in history:
            if msg.get("role") == "user":
                chat.send_message(msg.get("content", ""))
            # æ³¨æ„ï¼šåŠ©æ‰‹å›æ‡‰æœƒè‡ªå‹•è¨˜éŒ„åœ¨ ChatSession ä¸­ï¼Œä¸éœ€è¦æ‰‹å‹•åŠ å…¥
        
        # ç™¼é€ç•¶å‰ç”¨æˆ¶è¨Šæ¯ä¸¦å–å¾—å›æ‡‰
        response = chat.send_message(user_message)
        return response.text
        
    except Exception as e:
        return f"âš ï¸ AI é€£ç·šéŒ¯èª¤: {str(e)}"
```

**âœ… é©—æ”¶æ¨™æº–**ï¼š
- [ ] æª”æ¡ˆå·²å»ºç«‹ä¸”èªæ³•æ­£ç¢º
- [ ] å¯ä»¥æˆåŠŸ `from utils.gemini_client import call_gemini_logic`
- [ ] API Key æª¢æŸ¥é‚è¼¯æ­£ç¢º

**ğŸ” æ¸¬è©¦æª¢æŸ¥**ï¼š

å»ºç«‹æ¸¬è©¦æª”æ¡ˆ `test_gemini_client.py`ï¼š

```python
# test_gemini_client.py
import os
from dotenv import load_dotenv
from utils.gemini_client import call_gemini_logic

load_dotenv()

# æ¸¬è©¦ 1ï¼šç¢ºèª API Key å­˜åœ¨
api_key = os.getenv("GEMINI_API_KEY")
if not api_key:
    print("âš ï¸ è­¦å‘Šï¼šæœªè¨­å®š GEMINI_API_KEYï¼Œè·³é API æ¸¬è©¦")
else:
    print("âœ… API Key å·²è¨­å®š")
    
    # æ¸¬è©¦ 2ï¼šç°¡å–®çš„ API å‘¼å«ï¼ˆéœ€è¦çœŸå¯¦çš„ API Keyï¼‰
    try:
        response = call_gemini_logic(
            system_prompt="ä½ æ˜¯ä¸€å€‹æ¸¬è©¦åŠ©æ‰‹ã€‚",
            user_message="è«‹å›ç­”ï¼š1+1ç­‰æ–¼å¤šå°‘ï¼Ÿ",
            history=[]
        )
        assert len(response) > 0
        print(f"âœ… æ¸¬è©¦é€šéï¼šAPI å‘¼å«æˆåŠŸï¼Œå›æ‡‰é•·åº¦ï¼š{len(response)}")
    except Exception as e:
        print(f"âš ï¸ API æ¸¬è©¦å¤±æ•—ï¼š{e}")
        print("   é€™å¯èƒ½æ˜¯å› ç‚º API Key ç„¡æ•ˆæˆ–ç¶²è·¯å•é¡Œ")
```

åŸ·è¡Œæ¸¬è©¦ï¼š`python test_gemini_client.py`

**âš ï¸ æ³¨æ„äº‹é …**ï¼š
- ç¢ºä¿ `.env` æª”æ¡ˆä¸­çš„ API Key æ­£ç¢º
- å¦‚æœ API Key ç„¡æ•ˆï¼Œæœƒè¿”å›éŒ¯èª¤è¨Šæ¯è€Œéå´©æ½°
- æ³¨æ„ API å‘¼å«çš„æˆæœ¬ï¼ˆæ¯æ¬¡å‘¼å«éƒ½æœƒè¨ˆè²»ï¼‰

---

### æ­¥é©Ÿ 3.5ï¼šå¯¦ä½œ AdvisorNode (nodes/advisor.py)

**åŸ·è¡Œå‹•ä½œ**ï¼š

å»ºç«‹ `nodes/advisor.py`ï¼Œåƒè€ƒ PDR.md 4.3 ç¯€å’Œç¬¬ä¸ƒç« çš„å®Œæ•´ç¨‹å¼ç¢¼ã€‚

**âœ… é©—æ”¶æ¨™æº–**ï¼š
- [ ] æª”æ¡ˆå·²å»ºç«‹ä¸”èªæ³•æ­£ç¢º
- [ ] å¯ä»¥æˆåŠŸ `from nodes.advisor import AdvisorNode`
- [ ] æ”¯æ´å…©ç¨® intentï¼šGENERATE_REPORT å’Œ CHAT_FOLLOWUP

**ğŸ” æ¸¬è©¦æª¢æŸ¥**ï¼š

å»ºç«‹æ¸¬è©¦æª”æ¡ˆ `test_advisor.py`ï¼š

```python
# test_advisor.py
from nodes.advisor import AdvisorNode
from nodes.calculator import CalculatorNode

# æ¸¬è©¦ 1ï¼šç¢ºä¿ AdvisorNode å¯ä»¥å»ºç«‹
node = AdvisorNode("Advisor")
print("âœ… æ¸¬è©¦é€šéï¼šAdvisorNode å¯ä»¥å»ºç«‹")

# æ¸¬è©¦ 2ï¼šæ¸¬è©¦ GENERATE_REPORT æ¨¡å¼ï¼ˆéœ€è¦å…ˆåŸ·è¡Œ CalculatorNodeï¼‰
calculator = CalculatorNode("Calculator")
context = {
    "user_input": {
        "revenue": 1000,
        "net_profit": 200,
        "employees": 5,
        "avg_salary": 40000,
        "retention_rate": 0.7,
        "style": "ç©©å¥å‹"
    },
    "current_intent": "GENERATE_REPORT"
}

# å…ˆåŸ·è¡Œ Calculator
context = calculator.execute(context)

# å†åŸ·è¡Œ Advisorï¼ˆé€™æœƒçœŸçš„å‘¼å« APIï¼Œéœ€è¦ API Keyï¼‰
try:
    result = node.execute(context)
    assert "ai_response" in result
    assert "system_prompt" in result
    print("âœ… æ¸¬è©¦é€šéï¼šAdvisorNode å¯ä»¥åŸ·è¡Œï¼ˆéœ€è¦ API Keyï¼‰")
except Exception as e:
    print(f"âš ï¸ æ¸¬è©¦è·³éï¼šAPI å‘¼å«å¤±æ•—ï¼ˆå¯èƒ½æ˜¯ API Key å•é¡Œï¼‰ï¼š{e}")
```

**âš ï¸ æ³¨æ„äº‹é …**ï¼š
- AdvisorNode ä¾è³´ CalculatorNode çš„è¼¸å‡ºï¼ˆéœ€è¦å…ˆåŸ·è¡Œ Calculatorï¼‰
- ç¢ºä¿å¾ `config.settings` è®€å– PROMPT_TEMPLATES
- ç¢ºä¿å¾ `assets.knowledge` è®€å– BONUS_KB_TEXT

---

## éšæ®µå››ï¼šå‰ç«¯æ•´åˆ (Frontend Integration)

### æ­¥é©Ÿ 4.1ï¼šå»ºç«‹ main.py éª¨æ¶

**åŸ·è¡Œå‹•ä½œ**ï¼š

å»ºç«‹ `main.py`ï¼Œå…ˆå»ºç«‹åŸºæœ¬çµæ§‹ï¼Œä¸æ¥é‚è¼¯ã€‚

**åŸºæœ¬éª¨æ¶**ï¼š

```python
# main.py
import streamlit as st
from core.pipeline import Pipeline
from nodes.calculator import CalculatorNode
from nodes.advisor import AdvisorNode
from config.settings import (
    FORM_FIELDS, 
    QUICK_QUESTIONS, 
    BUTTON_LABELS, 
    PAGE_TITLE, 
    PAGE_HEADER,
    STYLE_DESCRIPTIONS
)

# 1. é é¢è¨­å®š
st.set_page_config(page_title=PAGE_TITLE, layout="wide")
st.title(PAGE_HEADER)

# 2. ç‹€æ…‹åˆå§‹åŒ–
if "pipeline_context" not in st.session_state:
    st.session_state.pipeline_context = {}
if "messages" not in st.session_state:
    st.session_state.messages = []
if "data_changed" not in st.session_state:
    st.session_state.data_changed = False

# 3. åˆå§‹åŒ– Pipeline
@st.cache_resource
def get_pipeline():
    pipe = Pipeline()
    pipe.add_node(CalculatorNode("Calculator"))
    pipe.add_node(AdvisorNode("Advisor"))
    return pipe

pipeline = get_pipeline()

# 4. Sidebarï¼ˆå…ˆä¸æ¥é‚è¼¯ï¼Œåªé¡¯ç¤º UIï¼‰
with st.sidebar:
    st.title("ğŸ¯ CEO æ±ºç­–æ§“æ¡¿")
    st.write("è¡¨å–®æ¬„ä½å°‡åœ¨é€™è£¡é¡¯ç¤º...")

# 5. ä¸»é é¢
st.write("ä¸»é é¢å…§å®¹å°‡åœ¨é€™è£¡é¡¯ç¤º...")
```

**âœ… é©—æ”¶æ¨™æº–**ï¼š
- [ ] æª”æ¡ˆå·²å»ºç«‹ä¸”èªæ³•æ­£ç¢º
- [ ] åŸ·è¡Œ `streamlit run main.py` å¯ä»¥å•Ÿå‹•ï¼ˆå³ä½¿åŠŸèƒ½ä¸å®Œæ•´ï¼‰
- [ ] é é¢å¯ä»¥æ­£å¸¸é¡¯ç¤ºæ¨™é¡Œ

**ğŸ” æ¸¬è©¦æª¢æŸ¥**ï¼š

```bash
# åœ¨çµ‚ç«¯æ©ŸåŸ·è¡Œ
streamlit run main.py
```

**é æœŸçµæœ**ï¼š
- ç€è¦½å™¨è‡ªå‹•æ‰“é–‹ï¼Œé¡¯ç¤º Streamlit ä»‹é¢
- æ¨™é¡Œé¡¯ç¤º "ğŸ¤– GoldenBonus å¹´çµ‚çé‡‘é¡§å•"
- å´é‚Šæ¬„é¡¯ç¤º "ğŸ¯ CEO æ±ºç­–æ§“æ¡¿"

**âš ï¸ æ³¨æ„äº‹é …**ï¼š
- å¦‚æœå‡ºç¾ ImportErrorï¼Œæª¢æŸ¥æ‰€æœ‰ `__init__.py` æª”æ¡ˆæ˜¯å¦å­˜åœ¨
- å¦‚æœå‡ºç¾ ModuleNotFoundErrorï¼Œç¢ºèªç•¶å‰ç›®éŒ„æ˜¯å°ˆæ¡ˆæ ¹ç›®éŒ„

---

### æ­¥é©Ÿ 4.2ï¼šå¯¦ä½œ Sidebar è¡¨å–®ï¼ˆå¾é…ç½®ä¸­å¿ƒè®€å–ï¼‰

**åŸ·è¡Œå‹•ä½œ**ï¼š

åœ¨ `main.py` ä¸­å¯¦ä½œå®Œæ•´çš„ Sidebarï¼Œåƒè€ƒ PDR.md ç¬¬äº”ç« å’Œ streamlitä»‹é¢.mdã€‚

**é—œéµç¨‹å¼ç¢¼ç‰‡æ®µ**ï¼š

```python
# å®šç¾© reset_on_change å›èª¿å‡½æ•¸
def reset_on_change():
    st.session_state.pipeline_context = {}
    st.session_state.messages = []
    st.session_state.data_changed = True

# Sidebar å®Œæ•´å¯¦ä½œ
with st.sidebar:
    st.title("ğŸ¯ CEO æ±ºç­–æ§“æ¡¿")
    
    # æ§“æ¡¿ 1ï¼šç”Ÿå­˜æ§“æ¡¿
    st.subheader("ğŸ›¡ï¸ ç”Ÿå­˜æ§“æ¡¿ (Safety Margin)")
    retention = st.slider(
        FORM_FIELDS["retention"]["label"],
        min_value=FORM_FIELDS["retention"]["min_value"],
        max_value=FORM_FIELDS["retention"]["max_value"],
        value=FORM_FIELDS["retention"]["default"],
        help=FORM_FIELDS["retention"]["help"],
        on_change=reset_on_change
    )
    
    # ... å…¶ä»–æ¬„ä½ï¼ˆåƒè€ƒ PDR.md å®Œæ•´ç¨‹å¼ç¢¼ï¼‰...
    
    start_btn = st.button(BUTTON_LABELS["generate"], type="primary", use_container_width=True)
```

**âœ… é©—æ”¶æ¨™æº–**ï¼š
- [ ] æ‰€æœ‰è¡¨å–®æ¬„ä½éƒ½å¾ `FORM_FIELDS` è®€å–
- [ ] æ‰€æœ‰æ¬„ä½éƒ½æœ‰ `on_change=reset_on_change`
- [ ] å­˜æ´»æœˆæ•¸é¡¯ç¤ºé‚è¼¯æ­£ç¢ºï¼ˆä¸ä¾è³´ Pipelineï¼‰

**ğŸ” æ¸¬è©¦æª¢æŸ¥**ï¼š

1. **æ‰‹å‹•æ¸¬è©¦**ï¼š
   - [ ] æ‰“é–‹ Streamlit ä»‹é¢
   - [ ] èª¿æ•´ Sliderï¼Œç¢ºèªå­˜æ´»æœˆæ•¸å³æ™‚æ›´æ–°
   - [ ] èª¿æ•´ä»»ä½•æ¬„ä½ï¼Œç¢ºèªä¸æœƒå ±éŒ¯

2. **é‚Šç•Œå€¼æ¸¬è©¦**ï¼š
   - [ ] å°‡å“¡å·¥æ•¸è¨­ç‚º 0ï¼Œç¢ºèªæœ‰éŒ¯èª¤æç¤º
   - [ ] å°‡å¹³å‡æœˆè–ªè¨­ç‚º 0ï¼Œç¢ºèªæœ‰éŒ¯èª¤æç¤º
   - [ ] å°‡æ·¨åˆ©è¨­ç‚ºè² æ•¸ï¼Œç¢ºèªè¨ˆç®—æ­£å¸¸ï¼ˆå¯èƒ½å‡ºç¾è² æ•¸çµæœï¼‰

**âš ï¸ æ³¨æ„äº‹é …**ï¼š
- ç¢ºä¿å­˜æ´»æœˆæ•¸è¨ˆç®—çš„å–®ä½æ›ç®—æ­£ç¢ºï¼ˆnet_profit æ˜¯è¬å…ƒï¼‰
- ç¢ºä¿æ‰€æœ‰æ¬„ä½éƒ½æœ‰é©ç•¶çš„ `min_value` è¨­å®š

---

### æ­¥é©Ÿ 4.3ï¼šå¯¦ä½œ Pipeline åŸ·è¡Œé‚è¼¯

**åŸ·è¡Œå‹•ä½œ**ï¼š

åœ¨ `main.py` ä¸­å¯¦ä½œæŒ‰éˆ•é»æ“Šå¾Œçš„ Pipeline åŸ·è¡Œé‚è¼¯ã€‚

**é—œéµç¨‹å¼ç¢¼**ï¼š

```python
# 4. åŸ·è¡Œé‚è¼¯ (Controller Layer)
if start_btn:
    # æº–å‚™åˆå§‹æ•¸æ“šåŒ…
    initial_context = {
        "user_input": {
            "revenue": revenue,
            "net_profit": net_profit,
            "employees": employees,
            "avg_salary": avg_salary,
            "retention_rate": retention / 100.0,
            "style": style
        },
        "current_intent": "GENERATE_REPORT"
    }
    
    # å•Ÿå‹• Pipeline
    with st.spinner("AI é¡§å•å¤§è…¦é‹ç®—ä¸­..."):
        try:
            result_context = pipeline.run(initial_context)
            
            # ä¿å­˜çµæœä¸¦æ¸…é™¤è®Šå‹•æ¨™è¨˜
            st.session_state.pipeline_context = result_context
            st.session_state.data_changed = False
            
            # é¡¯ç¤ºçµæœ
            # ...ï¼ˆä¸‹ä¸€æ­¥å¯¦ä½œï¼‰
            
        except Exception as e:
            st.error(f"ç³»çµ±éŒ¯èª¤ï¼š{str(e)}")
```

**âœ… é©—æ”¶æ¨™æº–**ï¼š
- [ ] é»æ“ŠæŒ‰éˆ•å¾Œ Pipeline å¯ä»¥æ­£å¸¸åŸ·è¡Œ
- [ ] éŒ¯èª¤è™•ç†æ­£ç¢ºï¼ˆä¸æœƒå´©æ½°ï¼‰
- [ ] çµæœæ­£ç¢ºä¿å­˜åˆ° `st.session_state.pipeline_context`

**ğŸ” æ¸¬è©¦æª¢æŸ¥**ï¼š

1. **åŠŸèƒ½æ¸¬è©¦**ï¼š
   - [ ] å¡«å¯«è¡¨å–®ï¼Œé»æ“Šã€Œç”Ÿæˆè‰æ¡ˆã€
   - [ ] ç¢ºèªçµ‚ç«¯æ©Ÿé¡¯ç¤º Pipeline åŸ·è¡Œæ—¥èªŒ
   - [ ] ç¢ºèªæ²’æœ‰éŒ¯èª¤è¨Šæ¯

2. **éŒ¯èª¤æ¸¬è©¦**ï¼š
   - [ ] å°‡å“¡å·¥æ•¸è¨­ç‚º 0ï¼Œé»æ“ŠæŒ‰éˆ•ï¼Œç¢ºèªé¡¯ç¤ºå‹å–„çš„éŒ¯èª¤è¨Šæ¯
   - [ ] å°‡ API Key è¨­ç‚ºéŒ¯èª¤å€¼ï¼Œç¢ºèªé¡¯ç¤º API éŒ¯èª¤è¨Šæ¯

**âš ï¸ æ³¨æ„äº‹é …**ï¼š
- ç¢ºä¿ `retention_rate` è½‰æ›ç‚ºå°æ•¸ï¼ˆé™¤ä»¥ 100.0ï¼‰
- ç¢ºä¿éŒ¯èª¤ä¸æœƒå°è‡´æ•´å€‹æ‡‰ç”¨å´©æ½°

---

### æ­¥é©Ÿ 4.4ï¼šå¯¦ä½œçµæœé¡¯ç¤ºï¼ˆMetrics å„€è¡¨æ¿ï¼‰

**åŸ·è¡Œå‹•ä½œ**ï¼š

åœ¨ `main.py` ä¸­å¯¦ä½œ Metrics å„€è¡¨æ¿é¡¯ç¤ºã€‚

**é—œéµç¨‹å¼ç¢¼**ï¼š

```python
# 5. é¡¯ç¤ºçµæœ (View Layer)
if "metrics" in st.session_state.pipeline_context:
    m = st.session_state.pipeline_context["metrics"]
    
    # 5.1 é¡¯ç¤º Metrics
    col1, col2, col3 = st.columns(3)
    col1.metric("ğŸ’° ç¸½çé‡‘æ± ", f"{m['total_pool']:,} å…ƒ")
    col2.metric("ğŸ‘¤ äººå‡é‡‘é¡", f"{m['per_head']:,} å…ƒ")
    
    # æœˆæ•¸é¡¯ç¤ºï¼ˆå¦‚æœ < 0.5ï¼Œé¡¯ç¤ºè­¦å‘Šé¡è‰²ï¼‰
    delta_color = "normal"
    if m['months'] < 0.5:
        delta_color = "inverse"  # ç´…è‰²è­¦å‘Š
    
    col3.metric("ğŸ“… å¹³å‡æœˆæ•¸", f"{m['months']} å€‹æœˆ", delta_color=delta_color)
```

**âœ… é©—æ”¶æ¨™æº–**ï¼š
- [ ] Metrics æ­£ç¢ºé¡¯ç¤º
- [ ] æ•¸å­—æ ¼å¼åŒ–æ­£ç¢ºï¼ˆåƒåˆ†ä½é€—è™Ÿï¼‰
- [ ] ä½æ–¼ 0.5 å€‹æœˆæ™‚é¡¯ç¤ºç´…è‰²è­¦å‘Š

**ğŸ” æ¸¬è©¦æª¢æŸ¥**ï¼š

1. **æ­£å¸¸æƒ…æ³æ¸¬è©¦**ï¼š
   - [ ] å¡«å¯«æ­£å¸¸æ•¸æ“šï¼Œç¢ºèªä¸‰å€‹ Metrics éƒ½æ­£ç¢ºé¡¯ç¤º
   - [ ] ç¢ºèªæ•¸å­—æ ¼å¼åŒ–ï¼ˆæœ‰åƒåˆ†ä½é€—è™Ÿï¼‰

2. **è­¦å‘Šæƒ…æ³æ¸¬è©¦**ï¼š
   - [ ] å¡«å¯«æœƒå°è‡´ < 0.5 å€‹æœˆçš„æ•¸æ“š
   - [ ] ç¢ºèªã€Œå¹³å‡æœˆæ•¸ã€é¡¯ç¤ºç‚ºç´…è‰²

**âš ï¸ æ³¨æ„äº‹é …**ï¼š
- ä½¿ç”¨ `:,` æ ¼å¼åŒ–æ•¸å­—ï¼ˆPython çš„åƒåˆ†ä½æ ¼å¼åŒ–ï¼‰
- ç¢ºä¿ Metrics åªåœ¨æœ‰çµæœæ™‚é¡¯ç¤ºï¼ˆæª¢æŸ¥ `pipeline_context` æ˜¯å¦å­˜åœ¨ï¼‰

---

### æ­¥é©Ÿ 4.5ï¼šå¯¦ä½œ AI å»ºè­°æ›¸é¡¯ç¤º

**åŸ·è¡Œå‹•ä½œ**ï¼š

åœ¨ `main.py` ä¸­å¯¦ä½œ AI å»ºè­°æ›¸çš„é¡¯ç¤ºå€åŸŸã€‚

**é—œéµç¨‹å¼ç¢¼**ï¼š

```python
# 5.2 é¡¯ç¤º AI å»ºè­°
if "ai_response" in st.session_state.pipeline_context:
    st.markdown("---")
    st.subheader("ğŸ“‹ æ±ºç­–å‚™å¿˜éŒ„ (Executive Memo)")
    
    with st.container(border=True):
        st.markdown(st.session_state.pipeline_context["ai_response"])
    
    # 5.3 é–‹ç™¼è€…è¦–è§’ï¼ˆå¯é¸ï¼‰
    with st.expander("ğŸ”§ é–‹ç™¼è€…è¦–è§’ (Debug Info)"):
        st.text(st.session_state.pipeline_context.get("system_prompt", ""))
```

**âœ… é©—æ”¶æ¨™æº–**ï¼š
- [ ] AI å»ºè­°æ­£ç¢ºé¡¯ç¤º
- [ ] Markdown æ ¼å¼æ­£ç¢ºæ¸²æŸ“
- [ ] æœ‰é‚Šæ¡†å®¹å™¨åŒ…åœ

**ğŸ” æ¸¬è©¦æª¢æŸ¥**ï¼š

1. **é¡¯ç¤ºæ¸¬è©¦**ï¼š
   - [ ] ç”Ÿæˆå ±å‘Šå¾Œï¼Œç¢ºèª AI å»ºè­°æ­£ç¢ºé¡¯ç¤º
   - [ ] ç¢ºèª Markdown æ ¼å¼ï¼ˆæ¨™é¡Œã€ç²—é«”ç­‰ï¼‰æ­£ç¢ºæ¸²æŸ“

2. **æ ¼å¼æ¸¬è©¦**ï¼š
   - [ ] ç¢ºèªã€Œé»ƒé‡‘ä¸‰æ®µå¼ã€æ ¼å¼æ­£ç¢º
   - [ ] ç¢ºèªä¸è¶…éä¸€é é•·åº¦

**âš ï¸ æ³¨æ„äº‹é …**ï¼š
- ä½¿ç”¨ `st.markdown()` æ¸²æŸ“ AI å›æ‡‰ï¼ˆæ”¯æ´ Markdownï¼‰
- ç¢ºä¿åªåœ¨æœ‰ `ai_response` æ™‚é¡¯ç¤º

---

### æ­¥é©Ÿ 4.6ï¼šå¯¦ä½œäº’å‹•è«®è©¢å€ï¼ˆèŠå¤©åŠŸèƒ½ï¼‰

**åŸ·è¡Œå‹•ä½œ**ï¼š

åœ¨ `main.py` ä¸­å¯¦ä½œå®Œæ•´çš„èŠå¤©åŠŸèƒ½ï¼Œåƒè€ƒ PDR.md ç¬¬ä¸ƒç« çš„å®Œæ•´ç¨‹å¼ç¢¼ã€‚

**é—œéµæª¢æŸ¥é»**ï¼š

1. **æ•¸æ“šåŒæ­¥æª¢æŸ¥**ï¼š
   ```python
   # å¦‚æœæ•¸æ“šå·²è®Šå‹•ä½†æœªé‡æ–°ç”Ÿæˆï¼Œç¦ç”¨èŠå¤©åŠŸèƒ½
   if st.session_state.get("data_changed", False):
       st.warning("âš ï¸ **æ•¸æ“šå·²è®Šæ›´**ï¼šè«‹å…ˆé»æ“Šã€Œç”Ÿæˆåˆ†é…è‰æ¡ˆã€æŒ‰éˆ•æ›´æ–°åˆ†æï¼Œæ‰èƒ½é–‹å§‹èŠå¤©ã€‚")
   ```

2. **å¿«æ·æŒ‰éˆ•**ï¼š
   ```python
   # å¾é…ç½®ä¸­å¿ƒè®€å–
   if col1.button(QUICK_QUESTIONS["analyze_risks"]["label"], use_container_width=True):
       quick_question = QUICK_QUESTIONS["analyze_risks"]["question"]
   ```

3. **èŠå¤©è¼¸å…¥è™•ç†**ï¼š
   ```python
   # åªåŸ·è¡Œ AdvisorNodeï¼ˆä½¿ç”¨å·²å­˜åœ¨çš„ contextï¼‰
   chat_pipeline = Pipeline()
   chat_pipeline.add_node(AdvisorNode("Advisor"))
   result_context = chat_pipeline.run(chat_context)
   ```

**âœ… é©—æ”¶æ¨™æº–**ï¼š
- [ ] æ•¸æ“šè®Šå‹•æ™‚èŠå¤©åŠŸèƒ½è¢«ç¦ç”¨
- [ ] å¿«æ·æŒ‰éˆ•å¯ä»¥æ­£å¸¸è§¸ç™¼å•é¡Œ
- [ ] èŠå¤©è¼¸å…¥å¯ä»¥æ­£å¸¸è™•ç†
- [ ] å°è©±æ­·å²æ­£ç¢ºä¿å­˜

**ğŸ” æ¸¬è©¦æª¢æŸ¥**ï¼š

1. **æ•¸æ“šåŒæ­¥æ¸¬è©¦**ï¼š
   - [ ] ç”Ÿæˆå ±å‘Šå¾Œï¼Œèª¿æ•´ Sidebar æ•¸æ“š
   - [ ] ç¢ºèªèŠå¤©å€é¡¯ç¤ºè­¦å‘Šï¼Œç„¡æ³•è¼¸å…¥
   - [ ] é‡æ–°ç”Ÿæˆå ±å‘Šå¾Œï¼ŒèŠå¤©åŠŸèƒ½æ¢å¾©

2. **èŠå¤©åŠŸèƒ½æ¸¬è©¦**ï¼š
   - [ ] é»æ“Šå¿«æ·æŒ‰éˆ•ï¼Œç¢ºèªå•é¡Œæ­£ç¢ºç™¼é€
   - [ ] æ‰‹å‹•è¼¸å…¥å•é¡Œï¼Œç¢ºèª AI å¯ä»¥å›ç­”
   - [ ] ç¢ºèªå°è©±æ­·å²æ­£ç¢ºé¡¯ç¤º

3. **ä¸Šä¸‹æ–‡æ¸¬è©¦**ï¼š
   - [ ] ç¢ºèª AI å›ç­”æ™‚çŸ¥é“ä¼æ¥­æ•¸æ“šï¼ˆç‡Ÿæ”¶ã€æ·¨åˆ©ç­‰ï¼‰
   - [ ] ç¢ºèª AI å›ç­”æ™‚çŸ¥é“å·²è¨ˆç®—çš„çµæœï¼ˆçé‡‘æ± ã€æœˆæ•¸ç­‰ï¼‰

**âš ï¸ æ³¨æ„äº‹é …**ï¼š
- ç¢ºä¿èŠå¤©æ™‚åªåŸ·è¡Œ AdvisorNodeï¼Œä¸é‡æ–°è¨ˆç®—
- ç¢ºä¿å°è©±æ­·å²æ­£ç¢ºç¶­è­·
- ç¢ºä¿éŒ¯èª¤è™•ç†ï¼ˆAPI å¤±æ•—æ™‚é¡¯ç¤ºå‹å–„è¨Šæ¯ï¼‰

---

## éšæ®µäº”ï¼šæ•´åˆæ¸¬è©¦èˆ‡é™¤éŒ¯ (Integration Testing)

### æ­¥é©Ÿ 5.1ï¼šç«¯åˆ°ç«¯æ¸¬è©¦ (End-to-End Testing)

**æ¸¬è©¦å ´æ™¯ 1ï¼šå®Œæ•´æµç¨‹æ¸¬è©¦**

1. æ‰“é–‹ Streamlit ä»‹é¢
2. å¡«å¯«æ‰€æœ‰è¡¨å–®æ¬„ä½
3. é»æ“Šã€Œç”Ÿæˆè‰æ¡ˆã€
4. ç¢ºèª Metrics é¡¯ç¤º
5. ç¢ºèª AI å»ºè­°é¡¯ç¤º
6. é»æ“Šå¿«æ·æŒ‰éˆ•ã€Œåˆ†ææ½›åœ¨é¢¨éšªã€
7. ç¢ºèª AI å¯ä»¥å›ç­”å•é¡Œ

**âœ… é©—æ”¶æ¨™æº–**ï¼š
- [ ] æ‰€æœ‰æ­¥é©Ÿéƒ½å¯ä»¥æ­£å¸¸åŸ·è¡Œ
- [ ] æ²’æœ‰éŒ¯èª¤è¨Šæ¯
- [ ] çµæœæ­£ç¢º

**æ¸¬è©¦å ´æ™¯ 2ï¼šæ•¸æ“šè®Šå‹•æ¸¬è©¦**

1. ç”Ÿæˆå ±å‘Š
2. èª¿æ•´ Sidebar çš„ç‡Ÿæ”¶ï¼ˆä¾‹å¦‚å¾ 1000 æ”¹ç‚º 2000ï¼‰
3. ç¢ºèªèŠå¤©å€é¡¯ç¤ºè­¦å‘Š
4. é‡æ–°ç”Ÿæˆå ±å‘Š
5. ç¢ºèªæ–°å ±å‘ŠåŸºæ–¼æ–°æ•¸æ“š

**âœ… é©—æ”¶æ¨™æº–**ï¼š
- [ ] æ•¸æ“šè®Šå‹•æ™‚èŠå¤©åŠŸèƒ½è¢«ç¦ç”¨
- [ ] é‡æ–°ç”Ÿæˆå¾Œçµæœæ›´æ–°
- [ ] èŠå¤©åŠŸèƒ½æ¢å¾©æ­£å¸¸

**æ¸¬è©¦å ´æ™¯ 3ï¼šéŒ¯èª¤è™•ç†æ¸¬è©¦**

1. å°‡å“¡å·¥æ•¸è¨­ç‚º 0ï¼Œé»æ“Šç”Ÿæˆ
2. ç¢ºèªé¡¯ç¤ºå‹å–„çš„éŒ¯èª¤è¨Šæ¯
3. ä¿®æ­£æ•¸æ“šï¼Œé‡æ–°ç”Ÿæˆ
4. ç¢ºèªå¯ä»¥æ­£å¸¸åŸ·è¡Œ

**âœ… é©—æ”¶æ¨™æº–**ï¼š
- [ ] éŒ¯èª¤ä¸æœƒå°è‡´æ‡‰ç”¨å´©æ½°
- [ ] éŒ¯èª¤è¨Šæ¯å‹å–„ä¸”æ˜ç¢º
- [ ] ä¿®æ­£å¾Œå¯ä»¥æ­£å¸¸åŸ·è¡Œ

---

### æ­¥é©Ÿ 5.2ï¼šé‚Šç•Œå€¼æ¸¬è©¦

**æ¸¬è©¦é …ç›®**ï¼š

1. **æ¥µå°å€¼æ¸¬è©¦**ï¼š
   - [ ] æ·¨åˆ© = 1 è¬
   - [ ] å“¡å·¥æ•¸ = 1
   - [ ] å¹³å‡æœˆè–ª = 1 å…ƒ

2. **æ¥µå¤§å€¼æ¸¬è©¦**ï¼š
   - [ ] æ·¨åˆ© = 10000 è¬
   - [ ] å“¡å·¥æ•¸ = 1000
   - [ ] å¹³å‡æœˆè–ª = 100000 å…ƒ

3. **é‚Šç•Œå€¼æ¸¬è©¦**ï¼š
   - [ ] ä¿ç•™ç›ˆé¤˜ = 0%
   - [ ] ä¿ç•™ç›ˆé¤˜ = 100%
   - [ ] å¹³å‡æœˆæ•¸ < 0.5ï¼ˆè§¸ç™¼é¢¨éšªè­¦å‘Šï¼‰

**âœ… é©—æ”¶æ¨™æº–**ï¼š
- [ ] æ‰€æœ‰é‚Šç•Œå€¼éƒ½å¯ä»¥æ­£å¸¸è™•ç†
- [ ] ä¸æœƒå‡ºç¾è¨ˆç®—éŒ¯èª¤
- [ ] é¢¨éšªè­¦å‘Šæ­£ç¢ºè§¸ç™¼

---

### æ­¥é©Ÿ 5.3ï¼šæ•ˆèƒ½æ¸¬è©¦

**æ¸¬è©¦é …ç›®**ï¼š

1. **API å›æ‡‰æ™‚é–“**ï¼š
   - [ ] ç”Ÿæˆå ±å‘Šçš„ API å‘¼å«æ™‚é–“ < 10 ç§’
   - [ ] èŠå¤©å›æ‡‰æ™‚é–“ < 5 ç§’

2. **ç‹€æ…‹ç®¡ç†**ï¼š
   - [ ] å¤šæ¬¡èª¿æ•´è¡¨å–®æ¬„ä½ï¼Œç¢ºèªç‹€æ…‹æ­£ç¢º
   - [ ] å¤šæ¬¡ç”Ÿæˆå ±å‘Šï¼Œç¢ºèªä¸æœƒç´¯ç©éŒ¯èª¤

**âœ… é©—æ”¶æ¨™æº–**ï¼š
- [ ] å›æ‡‰æ™‚é–“åœ¨å¯æ¥å—ç¯„åœå…§
- [ ] ç‹€æ…‹ç®¡ç†æ­£ç¢ºï¼Œä¸æœƒè¨˜æ†¶é«”æ´©æ¼

---

## éšæ®µå…­ï¼šéƒ¨ç½²æº–å‚™ (Deployment Preparation)

### æ­¥é©Ÿ 6.1ï¼šå»ºç«‹ .streamlit/config.toml

**åŸ·è¡Œå‹•ä½œ**ï¼š

å»ºç«‹ `.streamlit/config.toml`ï¼š

```toml
[theme]
primaryColor = "#FF4B4B"
backgroundColor = "#FFFFFF"
secondaryBackgroundColor = "#F0F2F6"
textColor = "#262730"
font = "sans serif"
```

**âœ… é©—æ”¶æ¨™æº–**ï¼š
- [ ] æª”æ¡ˆå·²å»ºç«‹
- [ ] åŸ·è¡Œ `streamlit run main.py` æ™‚ä¸»é¡Œæ­£ç¢ºæ‡‰ç”¨

---

### æ­¥é©Ÿ 6.2ï¼šå»ºç«‹ .gitignore

**åŸ·è¡Œå‹•ä½œ**ï¼š

å»ºç«‹ `.gitignore`ï¼š

```gitignore
# ç’°å¢ƒè®Šæ•¸
.env
.streamlit/secrets.toml

# Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
venv/
env/
ENV/

# IDE
.vscode/
.idea/
*.swp
*.swo

# æ¸¬è©¦
test_*.py
*.log
```

**âœ… é©—æ”¶æ¨™æº–**ï¼š
- [ ] æª”æ¡ˆå·²å»ºç«‹
- [ ] åŸ·è¡Œ `git status` ç¢ºèª `.env` ä¸æœƒè¢«è¿½è¹¤

---

### æ­¥é©Ÿ 6.3ï¼šå»ºç«‹ README.md

**åŸ·è¡Œå‹•ä½œ**ï¼š

å»ºç«‹ `README.md`ï¼ŒåŒ…å«ï¼š
- å°ˆæ¡ˆç°¡ä»‹
- å®‰è£æ­¥é©Ÿ
- ä½¿ç”¨èªªæ˜
- é…ç½®èªªæ˜

**âœ… é©—æ”¶æ¨™æº–**ï¼š
- [ ] æª”æ¡ˆå·²å»ºç«‹
- [ ] å…§å®¹å®Œæ•´ä¸”æ¸…æ™°

---

### æ­¥é©Ÿ 6.4ï¼šStreamlit Cloud éƒ¨ç½²ï¼ˆå¯é¸ï¼‰

**åŸ·è¡Œå‹•ä½œ**ï¼š

1. å°‡å°ˆæ¡ˆæ¨é€åˆ° GitHub
2. åœ¨ Streamlit Cloud é€£æ¥ GitHub å€‰åº«
3. è¨­å®š Secretsï¼ˆGEMINI_API_KEYï¼‰
4. éƒ¨ç½²

**âœ… é©—æ”¶æ¨™æº–**ï¼š
- [ ] æ‡‰ç”¨å¯ä»¥æ­£å¸¸è¨ªå•
- [ ] æ‰€æœ‰åŠŸèƒ½æ­£å¸¸é‹ä½œ
- [ ] API Key æ­£ç¢ºè¨­å®šï¼ˆé€é Secretsï¼‰

**âš ï¸ æ³¨æ„äº‹é …**ï¼š
- ä¸è¦åœ¨ GitHub ä¸Šå‚³ `.env` æª”æ¡ˆ
- ä½¿ç”¨ Streamlit Cloud çš„ Secrets åŠŸèƒ½è¨­å®š API Key

---

## ğŸ¯ æœ€çµ‚é©—æ”¶æ¸…å–®

åœ¨éƒ¨ç½²å‰ï¼Œè«‹ç¢ºèªä»¥ä¸‹æ‰€æœ‰é …ç›®ï¼š

### åŠŸèƒ½å®Œæ•´æ€§
- [ ] è¡¨å–®æ¬„ä½å¯ä»¥æ­£å¸¸è¼¸å…¥
- [ ] ç”Ÿæˆè‰æ¡ˆæŒ‰éˆ•å¯ä»¥æ­£å¸¸åŸ·è¡Œ
- [ ] Metrics å„€è¡¨æ¿æ­£ç¢ºé¡¯ç¤º
- [ ] AI å»ºè­°æ›¸æ­£ç¢ºé¡¯ç¤º
- [ ] å¿«æ·æŒ‰éˆ•å¯ä»¥æ­£å¸¸ä½¿ç”¨
- [ ] èŠå¤©è¼¸å…¥å¯ä»¥æ­£å¸¸ä½¿ç”¨
- [ ] æ•¸æ“šè®Šå‹•æ™‚èŠå¤©åŠŸèƒ½æ­£ç¢ºç¦ç”¨

### éŒ¯èª¤è™•ç†
- [ ] é™¤ä»¥é›¶éŒ¯èª¤æœ‰å‹å–„æç¤º
- [ ] API éŒ¯èª¤æœ‰å‹å–„æç¤º
- [ ] æ•¸æ“šè®Šå‹•æœ‰æ˜ç¢ºè­¦å‘Š

### é…ç½®ä¸­å¿ƒ
- [ ] æ‰€æœ‰è¡¨å–®æ¬„ä½å¾ `config/settings.py` è®€å–
- [ ] æ‰€æœ‰å¿«æ·å•é¡Œå¾ `config/settings.py` è®€å–
- [ ] æ‰€æœ‰æç¤ºè©å¾ `config/settings.py` è®€å–
- [ ] çŸ¥è­˜åº«å¾ `assets/knowledge.py` è®€å–

### ç¨‹å¼ç¢¼å“è³ª
- [ ] æ²’æœ‰èªæ³•éŒ¯èª¤
- [ ] æ²’æœ‰æ˜é¡¯çš„é‚è¼¯éŒ¯èª¤
- [ ] æ‰€æœ‰æ¸¬è©¦éƒ½å¯ä»¥é€šé

---

## ğŸ“ é–‹ç™¼æ—¥èªŒç¯„æœ¬

å»ºè­°åœ¨é–‹ç™¼éç¨‹ä¸­è¨˜éŒ„ï¼š

```
æ—¥æœŸï¼š2024-XX-XX
éšæ®µï¼šéšæ®µ X - æ­¥é©Ÿ X.X
å®Œæˆé …ç›®ï¼š
- [ ] é …ç›® 1
- [ ] é …ç›® 2

é‡åˆ°çš„å•é¡Œï¼š
1. å•é¡Œæè¿°
   è§£æ±ºæ–¹æ¡ˆï¼š

æ¸¬è©¦çµæœï¼š
- [ ] æ¸¬è©¦é€šé
- [ ] éœ€è¦ä¿®æ­£

ä¸‹ä¸€æ­¥ï¼š
- [ ] æ­¥é©Ÿ X.X+1
```

---

## ğŸ†˜ å¸¸è¦‹å•é¡Œæ’é™¤

### å•é¡Œ 1ï¼šImportError: No module named 'core'

**åŸå› **ï¼šPython æ‰¾ä¸åˆ°æ¨¡çµ„

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. ç¢ºèªç•¶å‰ç›®éŒ„æ˜¯å°ˆæ¡ˆæ ¹ç›®éŒ„
2. ç¢ºèªæ‰€æœ‰ `__init__.py` æª”æ¡ˆéƒ½å­˜åœ¨
3. ç¢ºèª Python è·¯å¾‘æ­£ç¢º

### å•é¡Œ 2ï¼šAPI Key éŒ¯èª¤

**åŸå› **ï¼š`.env` æª”æ¡ˆä¸­çš„ API Key ç„¡æ•ˆæˆ–æœªè¨­å®š

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. æª¢æŸ¥ `.env` æª”æ¡ˆæ˜¯å¦å­˜åœ¨
2. æª¢æŸ¥ API Key æ˜¯å¦æ­£ç¢º
3. ç¢ºèª `python-dotenv` å·²å®‰è£

### å•é¡Œ 3ï¼šStreamlit ç‹€æ…‹é‡ç½®

**åŸå› **ï¼šæ²’æœ‰æ­£ç¢ºä½¿ç”¨ `st.session_state`

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. ç¢ºèªæ‰€æœ‰éœ€è¦æŒä¹…åŒ–çš„æ•¸æ“šéƒ½å­˜åˆ° `st.session_state`
2. ç¢ºèª `reset_on_change` å›èª¿å‡½æ•¸æ­£ç¢ºè¨­å®š
3. åƒè€ƒ PDR.md ç¬¬ä¸ƒç« çš„ç‹€æ…‹ç®¡ç†é‚è¼¯

---

## ğŸ“ å­¸ç¿’è³‡æº

- Streamlit å®˜æ–¹æ–‡ä»¶ï¼šhttps://docs.streamlit.io/
- Google Gemini API æ–‡ä»¶ï¼šhttps://ai.google.dev/docs
- Python è™›æ“¬ç’°å¢ƒï¼šhttps://docs.python.org/3/tutorial/venv.html

---

**æœ€å¾Œæ›´æ–°**ï¼š2024-XX-XX  
**ç¶­è­·è€…**ï¼šç³»çµ±å·¥ç¨‹å¸« Jack

